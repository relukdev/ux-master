# Spec 08: Theme Package + Ecosystem

## Goal

Generate an npm-publishable theme package compatible with Semi Design ecosystem, plus Figma sync and MCP integration.

## Output: `semi-theme-{brand}` Package

```
output/{project}/theme-package/
├── package.json
├── README.md
├── scss/
│   ├── global.scss           # All token overrides
│   ├── _colors.scss          # Color tokens
│   ├── _typography.scss      # Typography tokens
│   ├── _spacing.scss         # Spacing tokens
│   └── _components.scss      # Component-level overrides
├── css/
│   └── theme.css             # Compiled CSS variables
├── tokens/
│   ├── figma-tokens.json     # Figma Tokens Studio format
│   └── style-dictionary.json # Style Dictionary format
└── index.js                  # Theme registration for Semi
```

### package.json

```json
{
  "name": "semi-theme-{{projectSlug}}",
  "version": "1.0.0",
  "description": "Semi Design theme extracted from {{projectName}}",
  "main": "index.js",
  "files": ["scss/", "css/", "tokens/"],
  "peerDependencies": {
    "@douyinfe/semi-ui": ">=2.0.0"
  },
  "keywords": ["semi-design", "theme", "design-system"],
  "author": "Generated by UX Master Harvester v4"
}
```

### index.js — Theme Registration

```javascript
// Semi Design theme registration
module.exports = {
  name: '{{projectSlug}}',
  import: './scss/global.scss',
  // Token overrides
  tokens: require('./tokens/style-dictionary.json'),
};
```

### global.scss — Following Semi's Structure

```scss
// Reference: DouyinFE/semi-design/packages/semi-theme-default/scss/global.scss

// === Color System ===
$color-primary: {{primary}};
$color-secondary: {{secondary}};
// ... all Semi color variables

// === Typography ===
$font-family-regular: {{fontFamily}};
// ... all Semi typography variables

// === Spacing ===
$spacing-base: {{spacingBase}};
// ... 

// === Generate CSS custom properties ===
:root {
  @each $key, $value in $semi-tokens {
    --semi-#{$key}: #{$value};
  }
}
```

## Figma Tokens Bidirectional Sync

### Export: Tokens → Figma

Already works via `figma-tokens.json`. Enhance with:
- Token groups and descriptions
- Color references (`{primary.DEFAULT}`)
- Typography composite tokens

### Import: Figma → Tokens

```python
def import_figma_tokens(figma_json: dict) -> dict:
    """Convert Figma Tokens Studio JSON back to harvest format."""
    harvest = {"_version": 4, "visualAnalysis": {"colors": {"semantic": {}}}}
    
    for group_name, group in figma_json.items():
        if group_name == "color":
            for token_name, token in group.items():
                # Map Figma token → Semi CSS variable
                pass
    
    return harvest
```

## MCP Server Integration

Extend `scripts/semi_mcp_bridge.py`:

```python
# MCP tools for AI assistants
tools = [
    {
        "name": "get_design_token",
        "description": "Get the value of a design token by name",
        "parameters": {"token_name": "string"},
    },
    {
        "name": "search_components",
        "description": "Search available components by keyword",
        "parameters": {"query": "string"},
    },
    {
        "name": "get_component_code",
        "description": "Get the React/Vue code for a component",
        "parameters": {"component": "string", "framework": "string"},
    },
    {
        "name": "suggest_tokens_for_ui",
        "description": "Suggest design tokens for a described UI element",
        "parameters": {"description": "string"},
    },
]
```

## Acceptance Criteria

- [ ] Generated package has valid `package.json`
- [ ] `npm pack` succeeds on the generated package
- [ ] Theme applies correctly when used with Semi Design
- [ ] Figma tokens import/export roundtrips without data loss
- [ ] MCP server responds to token queries
- [ ] Theme editor changes export to updated package
